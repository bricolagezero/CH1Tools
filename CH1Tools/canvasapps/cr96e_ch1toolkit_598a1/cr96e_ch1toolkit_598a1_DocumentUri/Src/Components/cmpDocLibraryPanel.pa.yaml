# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
ComponentDefinitions:
  cmpDocLibraryPanel:
    DefinitionType: CanvasComponent
    AccessAppScope: true
    CustomProperties:
      Breadcrumbs:
        PropertyKind: Output
        DisplayName: Breadcrumbs
        Description: A custom property
        DataType: Table
      FolderSource:
        PropertyKind: Input
        DisplayName: FolderSource
        Description: A custom property
        DataType: Table
        Default: |+
          =Table(
              {
                  'Name': "Sample.docx",
                  'Title': "Sample Title",
                  'Folder path': "Content Templates/Business Development/",
                  'IsFolder': false,
                  'Link to item': "https://sharepoint.com/sites/example",
                  'Thumbnail': { Medium: "" },
                  'OData__ExtendedDescription': "Some description",
                  'Category': { Value: "Example Category" }
              }
          )
      IsOpen:
        PropertyKind: Output
        DisplayName: IsOpen
        Description: A custom property
        DataType: Boolean
      OnAddRequested:
        PropertyKind: Event
        DisplayName: OnAddRequested
        Description: A custom property
        ReturnType: None
        Default: =
      OnClose:
        PropertyKind: Event
        DisplayName: OnClose
        Description: A custom property
        ReturnType: None
        Default: =
      OnFileOpened:
        PropertyKind: Event
        DisplayName: OnFileOpened
        Description: A custom property
        ReturnType: None
        Default: =
      SelectedFolderName:
        PropertyKind: Output
        DisplayName: SelectedFolderName
        Description: A custom property
        DataType: Text
      SelectedFolderPath:
        PropertyKind: Output
        DisplayName: SelectedFolderPath
        Description: A custom property
        DataType: Text
      ShowAddButton:
        PropertyKind: Input
        DisplayName: ShowAddButton
        Description: A custom property
        DataType: Boolean
        Default: =true
      StartFolderPath:
        PropertyKind: Input
        DisplayName: StartFolderPath
        Description: A custom property
        DataType: Text
        Default: ="Text"
    Properties:
      Breadcrumbs: |-
        =Table({SampleStringField: "SampleText", SampleNumberField: 10, SampleBooleanField: true})
      Height: =715
      IsOpen: =true
      SelectedFolderName: ="Text"
      SelectedFolderPath: ="Text"
      Width: =850
    Children:
      - Right_Container:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Height: =629
            PaddingBottom: =50
            PaddingLeft: =50
            PaddingRight: =50
            PaddingTop: =50
            Width: =850
            Y: =86
          Children:
            - FolderGallery:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0
                Properties:
                  Height: =543
                  Items: |+
                    =Filter(
                        cmpDocLibraryPanel.FolderSource,
                        IsFolder
                    )
                  OnSelect: |+
                    =Collect(
                        colDocPanelCrumbs,
                        {
                            Title: ThisItem.Name,
                            Path: ThisItem.'Folder path' & ThisItem.Name & "/"
                        }
                    )
                  ShowNavigation: =true
                  Transition: =Transition.Pop
                  Width: =838
                  X: =12
                  Y: =86
                Children:
                  - Container6:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        Height: =104
                        PaddingBottom: =50
                        PaddingLeft: =50
                        PaddingRight: =50
                        PaddingTop: =50
                        Width: =850
                      Children:
                        - NextArrow1:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              AccessibleLabel: =Self.Tooltip
                              BorderColor: =RGBA(0, 0, 0, 1)
                              Color: =RGBA(166, 166, 166, 1)
                              DisabledBorderColor: =RGBA(56, 56, 56, 1)
                              DisabledColor: =RGBA(119, 119, 119, 1)
                              Height: =50
                              Icon: =Icon.ChevronRight
                              OnSelect: |+
                                =Set(
                                    varActiveFolder,
                                    ThisItem.'Folder path' & ThisItem.Name & "/"
                                );
                                Collect(
                                    colDocPanelCrumbs,
                                    {
                                        Title: ThisItem.Name,
                                        Path: varActiveFolder
                                    }
                                );
                                ClearCollect(
                                    colCategoryStrings,
                                    ForAll(
                                        Filter(
                                            ContentLibrary,
                                            'Folder path' = varActiveFolder,
                                            !IsBlank(Category.Value)
                                        ),
                                        { CategoryText: Category.Value }
                                    )
                                );
                                Reset(txtKBSearch_1);
                                ClearCollect(colCatPick, { Value: "" });
                                Clear(colCatPick);
                              PaddingBottom: =16
                              PaddingLeft: =16
                              PaddingRight: =16
                              PaddingTop: =16
                              Tooltip: ="View item details"
                              Width: =50
                              X: =726
                              Y: =11
                        - Subtitle1:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              BorderColor: =RGBA(0, 0, 0, 1)
                              FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                              Height: =36
                              OnSelect: |+
                                =Set(
                                    varActiveFolder,
                                    ThisItem.'Folder path' & ThisItem.Name & "/"
                                );
                                Collect(
                                    colDocPanelCrumbs,
                                    {
                                        Title: ThisItem.Name,
                                        Path: varActiveFolder
                                    }
                                );
                                ClearCollect(
                                    colCategoryStrings,
                                    ForAll(
                                        Filter(
                                            ContentLibrary,
                                            'Folder path' = varActiveFolder,
                                            !IsBlank(Category.Value)
                                        ),
                                        { CategoryText: Category.Value }
                                    )
                                );
                                Reset(txtKBSearch_1);
                                ClearCollect(colCatPick, { Value: "" });
                                Clear(colCatPick);
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =12
                              Text: =Coalesce(ThisItem.Description, "")
                              VerticalAlign: =VerticalAlign.Top
                              Width: =540
                              X: =186
                              Y: =Title1.Y + Title1.Height
                        - Title1:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 0, 0, 1)
                              Color: =RGBA(50, 49, 48, 1)
                              FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                              Height: =37
                              OnSelect: |+
                                =Set(
                                    varActiveFolder,
                                    ThisItem.'Folder path' & ThisItem.Name & "/"
                                );
                                Collect(
                                    colDocPanelCrumbs,
                                    {
                                        Title: ThisItem.Name,
                                        Path: varActiveFolder
                                    }
                                );
                                ClearCollect(
                                    colCategoryStrings,
                                    ForAll(
                                        Filter(
                                            ContentLibrary,
                                            'Folder path' = varActiveFolder,
                                            !IsBlank(Category.Value)
                                        ),
                                        { CategoryText: Category.Value }
                                    )
                                );
                                Reset(txtKBSearch_1);
                                ClearCollect(colCatPick, { Value: "" });
                                Clear(colCatPick);
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =14
                              Text: =ThisItem.Title
                              VerticalAlign: =VerticalAlign.Top
                              Width: =505
                              X: =186
                              Y: =11
                        - Image1:
                            Control: Image@2.2.3
                            Properties:
                              BorderThickness: =1
                              Height: =88
                              Image: =ThisItem.Thumbnail.Medium
                              OnSelect: |+
                                =Set(
                                    varActiveFolder,
                                    ThisItem.'Folder path' & ThisItem.Name & "/"
                                );
                                Collect(
                                    colDocPanelCrumbs,
                                    {
                                        Title: ThisItem.Name,
                                        Path: varActiveFolder
                                    }
                                );
                                ClearCollect(
                                    colCategoryStrings,
                                    ForAll(
                                        Filter(
                                            ContentLibrary,
                                            'Folder path' = varActiveFolder,
                                            !IsBlank(Category.Value)
                                        ),
                                        { CategoryText: Category.Value }
                                    )
                                );
                                Reset(txtKBSearch_1);
                                ClearCollect(colCatPick, { Value: "" });
                                Clear(colCatPick);
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Width: =97
                              X: =11
                              Y: =11
            - FileGallery:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0
                Properties:
                  Height: =543
                  Items: |+
                    =With(
                        {
                            picks: colCatPick,
                            q: Lower(Trim(txtKBSearch_1.Text)),
                            currentFolder: Last(colDocPanelCrumbs).Path
                        },
                        Filter(
                            cmpDocLibraryPanel.FolderSource,
                            !IsFolder,
                            'Folder path' = currentFolder,
                            IsEmpty(picks) || CountIf(picks, Value = Coalesce(Category.Value, "")) > 0,
                            Len(q) = 0
                                || StartsWith(Lower(Coalesce('Title', Title, "")), q)
                                || StartsWith(Lower(Coalesce(Description, "")), q)
                        )
                    )
                  ShowNavigation: =true
                  TemplateSize: =300
                  Transition: =Transition.Pop
                  Width: =850
                  WrapCount: =4
                  Y: =86
                Children:
                  - Container10:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        Height: =297
                        Width: =211
                      Children:
                        - Title2:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              BorderColor: =RGBA(0, 0, 0, 1)
                              Color: =RGBA(50, 49, 48, 1)
                              FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                              Height: =19
                              OnSelect: =
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =10
                              Text: |+
                                =Coalesce(ThisItem.Category.Value, "")
                              VerticalAlign: =VerticalAlign.Top
                              Width: =182
                              X: =18
                              Y: =14
                        - Image2:
                            Control: Image@2.2.3
                            Properties:
                              Height: =101
                              Image: =ThisItem.Thumbnail.Medium
                              OnSelect: =
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Width: =183
                              X: =17
                              Y: =135
                        - ButtonCanvas2:
                            Control: Button@0.0.45
                            Properties:
                              Height: =31
                              OnSelect: |+
                                =If(
                                    EndsWith(ThisItem.'Name', ".docx"),
                                    Launch("ms-word:ofe|u|" & ThisItem.'Link to item'),
                                    If(
                                        EndsWith(ThisItem.'Name', ".pptx"),
                                        Launch("ms-powerpoint:ofe|u|" & ThisItem.'Link to item'),
                                        Launch(ThisItem.'Link to item')  // fallback for other files
                                    )
                                );
                                cmpDocLibraryPanel.OnFileOpened()
                              Text: ="Open"
                              Width: =89
                              X: =64
                              Y: =248
                        - HtmlText1:
                            Control: HtmlViewer@2.1.0
                            Properties:
                              Height: =114
                              HtmlText: =Coalesce(ThisItem.Description, "")
                              Size: =8
                              Width: =197
                              X: =3
                              Y: =33
            - BreadcrumbsLabel:
                Control: Label@2.5.1
                Properties:
                  Height: =50
                  Text: |+
                    ="/" & Concat(colDocPanelCrumbs, Title, " / ")
                  Width: =850
                  Y: =3
      - cntToolbar_1:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            DropShadow: =DropShadow.Semilight
            Fill: =RGBA(124, 141, 108, 1)
            Height: =86
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutDirection: =LayoutDirection.Horizontal
            LayoutGap: =20
            LayoutJustifyContent: =LayoutJustifyContent.Center
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Width: =850
          Children:
            - Search_1:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  Height: =90
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =10
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutMinHeight: =50
                Children:
                  - txtKBSearch_1:
                      Control: Classic/TextInput@2.3.2
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(214, 221, 224, 1)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =1
                        Clear: =true
                        Default: =
                        DisabledBorderColor: =
                        DisabledColor: =
                        DisabledFill: =
                        EnableSpellCheck: =true
                        FocusedBorderColor: =
                        FocusedBorderThickness: =1
                        Height: =35
                        HintText: ="Type to filter"
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Size: =10
                        Width: =250
            - Pills_1:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  Height: =50
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =5
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutMinHeight: =50
                  LayoutMinWidth: =300
                  LayoutOverflowX: =LayoutOverflow.Scroll
                  X: =40
                  Y: =40
                Children:
                  - galKBCatPills_1:
                      Control: Gallery@2.15.0
                      Variant: BrowseLayout_Horizontal_TwoTextOneImageVariant_ver5.0
                      Properties:
                        Height: =40
                        Items: |-
                          =Sort(
                              Distinct(colCategoryStrings, CategoryText),
                              Result,
                              SortOrder.Ascending
                          )
                        LayoutMinHeight: =50
                        OnSelect: =
                        ShowNavigation: =true
                        TemplateSize: =100
                        Transition: =Transition.Push
                        Width: '=300 '
                        X: =40
                        Y: =40
                      Children:
                        - btnCat_1:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =0
                              Color: |+
                                =RGBA(44, 47, 37, 1)
                              DisabledBorderColor: =
                              DisabledColor: =
                              DisabledFill: =
                              Fill: |+
                                =If(
                                    CountIf(colCatPick, Value = ThisItem.Result) > 0,
                                    RGBA(240, 243, 226, 1),
                                    RGBA(44, 47, 37, 0.2)
                                )

                              Height: =25
                              HoverBorderColor: =
                              HoverColor: =
                              HoverFill: =
                              OnSelect: |+
                                =With(
                                    { val: ThisItem.Result },
                                    If(
                                        CountIf(colCatPick, Value = val) > 0,
                                        RemoveIf(colCatPick, Value = val),
                                        Collect(colCatPick, { Value: val })
                                    )
                                )

                              PressedBorderColor: =
                              PressedColor: =
                              PressedFill: =
                              Size: =10
                              Text: =ThisItem.Result
                              Width: =92
                              Y: =30
            - Add Knowledge_1:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  Height: =Parent.Height
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutMinHeight: =50
                  PaddingLeft: =15
                  PaddingRight: =15
                  Width: =150
                  X: =40
                  Y: =40
